<!doctype html><html class="dark light"><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><title>
         multicast
        
    </title><meta content=multicast property=og:title><meta content="An elegant and understated" property=og:description><meta content="An elegant and understated" name=description><link href=/icon/favicon.png rel=icon type=image/png><link href=https://ashang.github.io/zz/fonts.css rel=stylesheet><script>MathJax={tex:{inlineMath:[['$','$'],['\\(','\\)']]}}</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link href=https://ashang.github.io/zz/atom.xml rel=alternate title=atbb type=application/atom+xml><link href=https://ashang.github.io/zz/theme/light.css rel=stylesheet><link href=https://ashang.github.io/zz/theme/dark.css id=darkModeStyle rel=stylesheet><link href=https://ashang.github.io/zz/main.css media=screen rel=stylesheet><body><div class=content><header><div class=main><a href=https://ashang.github.io/zz/>atbb</a><div class=socials><a class=social href=https://github.com/ashang/ rel=me> <img alt=github src=/social_icons/github.svg> </a></div></div><nav><a href=$BASE_URL/search/ style=margin-left:.7em>Search</a><a href=/notes style=margin-left:.7em>/notes</a><a href=/posts style=margin-left:.7em>/posts</a><a href=/gallery style=margin-left:.7em>/gallery</a><a href=/tags style=margin-left:.7em>/tags</a><a href=/projects style=margin-left:.7em>/projects</a> | <a href=javascript:void(0) id=dark-mode-toggle onclick=toggleTheme()> <img id=sun-icon src=/feather/sun.svg style=filter:invert(1)> <img id=moon-icon src=/feather/moon.svg> </a><script src=https://ashang.github.io/zz/js/themetoggle.js></script></nav></header><main><article><div class=title><div class=page-header>multicast<span class=primary-color style=font-size:1.6em>.</span></div><div class=meta>Posted on <time>2015-08-12</time></div></div><h1>Table of Contents</h1><ul><li><a href=https://ashang.github.io/zz/notes/multicast/#er-ceng-jiao-huan-yuan-li>二层交换原理</a><li><a href=https://ashang.github.io/zz/notes/multicast/#vlan>VLAN</a></ul><section class=body><p>发送端的IP在224.0.0.0~239.255.255.255范围内都算组播。<p>组播是一种数据包传播方式，源主机向多点目标主机发送信息需求时，源主机只发送一份数据，数据的目的地址是组播组地址，这样，凡是属于该组的成员，都可以接收到一份原主机发送的数据的拷贝，此组播方式下，只有真正信息需要的成员会收到信息，其他主机不会收到。<p>多播的MAC地址是最高字节的低位为1，例 如01-00-00-00-00-00。<p>多播组的地址是D类IP(D类IP多用于组播(多播))<p>规定是224.0.0.0-239.255.255.255。<p>然多播比较特殊，但是究其原理，多播的数据还是要通过数据链路层进行MAC地址绑定然后进行发送。<p>※<p>主机开机组播接收程序时，会向TCP/IP协议注册一个组播IP地址，所以当收到目的IP地址是这个组播组的地址时，主机就会接收。<p>同时它又向工作在数据链路层的网卡也注册了一个二层MAC地址，这样的话，当主机接收到一个组播报文的时候，就可以直接现在网卡上判断是否是自己所需要的组播报文。<p>IGMP：Internet组管理协议，用于主机与路由器之间交互信息的一种协议。所有要加入组播组的主机和所有连接到有组播主机的子网中的路由器都必须使用IGMP。IGMP消息不能被路由转发，只能限制在本地网段内部。IGMP的TTL参数永远是1，保证了IGMP的使用范围。<p>组播路由协议的主要功能是将组播数据从一台路由器跨越一个网络传送到另外一台路由器上。<p>组播的缺点<p>（1）与单播协议相比没有纠错机制，发生丢包错包难以弥补，但可以通过一定的容错机制和QOS加以弥补。<p>（2）现行网络虽然都支持组播的传输，但在客户认证、QOS等方面还需要完善，这些缺点在理论上都有成熟的解决方案，只是需要逐步推广应用到现存网络中。<p>二层广播一般是转发用的，三层是为寻址的，二层广播是交换机mac表里面没有目的mac然后二层广播。<p>三层广播用于在这个网络内向所有的节点发送数据。三层广播还有本地广播255.255.255.255和特定子网广播（定向广播），比如192.168.1.255/24之分。255.255.255.255这种本地广播是肯定没法跨越路由器的，因为一旦这种广播能跨越路由器的话，同样任何人发起的这种广播就会跑到Internet的任何角落。<p>然而对于特定子网的广播（定向广播）是可以配置为允许跨路由器或者不允许跨路由器的。如果允许的话，我就可以跨越路由器对特定的子网发起三层广播，问某某地址，你的MAC地址是多少，这时明显没有对方的MAC地址就用全１了．多数情况下，对方未知都是全１,自己未知是全0．比如DHCP获取地址时，自己是没有地址的，这时发的包中源地址就是全0的。<p>通常不要允许这类广播，因为你一旦允许了很容易造成ICMP Sumrf攻击的。<p>广播帧的产生<p>网络中存在有广播帧是不可避免的,比如开启了DHCP服务器, 每次请求, 都会有以”FF.FF.FF.FF.FF.FF”的帧格式出现．它向所有端口转发．假设主机A与B在同一个网络内,当主机A要向主机B发送信息,那么需要知道主机B的IP地址和MAC地址,这里面我们假定A只知道B的IP地址,而不知道 B的MAC地址,那么这时A就需要向网络中发送一个ARP请求,来获取B的MAC地址,这个ARP请求实际上就是一个广播包.<h2 id=er-ceng-jiao-huan-yuan-li>二层交换原理</h2><p>二层交换设备工作在OSI模型的第二层，即数据链路层，它对数据包的转发是建立在MAC（Media Access Control ）地址基础之上的。二层交换设备不同的接口发送和接收数据独立，各接口属于不同的冲突域，因此有效地隔离了网络中物理层冲突域，使得通过它互连的主机（或网络）之间不必再担心流量大小对于数据发送冲突的影响。<p>二层交换设备通过解析和学习以太网帧的源MAC来维护MAC地址与接口的对应关系（保存MAC与接口对应关系的表称为MAC表），通过其目的MAC来查找MAC表决定向哪个接口转发，基本流程如下：<pre style=background:#0f1419;color:#bfbab0><code><span>二层交换设备收到以太网帧，将其源MAC与接收接口的对应关系写入MAC表，作为以后的二层转发依据。如果MAC表中已有相同表项，那么就刷新该表项的老化时间。MAC表表项采取一定的老化更新机制，老化时间内未得到刷新的表项将被删除掉。
</span><span>根据以太网帧的目的MAC去查找MAC表，如果没有找到匹配表项，那么向所有接口转发（报文的入接口除外）；如果目的MAC是广播地址，那么向所有接口转发（报文的入接口除外）；如果能够找到匹配表项，则向表项所示的对应接口转发。
</span></code></pre><p>从上述流程可以看出，二层交换通过维护MAC表以及根据目的MAC查表转发，有效的利用了网络带宽，改善了网络性能。<p>二层交换设备虽然能够隔离冲突域，但是它并不能有效的划分广播域。因为从前面介绍的二层交换设备转发流程可以看出，广播报文以及目的MAC查找失败的报文会向除报文的入接口之外的其它所有接口转发，当网络中的主机数量增多时，这种情况会消耗大量的网络带宽，并且在安全性方面也带来一系列问题。当然，通过路由器来隔离广播域是一个办法，但是由于路由器的高成本以及转发性能低的特点使得这一方法应用有限。基于这些情况，二层交换中出现了VLAN技术。<h2 id=vlan>VLAN</h2><p>路由器三层接口无法处理携带VLAN Tag的数据帧，因此交换机上联路由器的接口需配置为Access，两个路由器之间可以连trunk口。 3. native-vlan-id 和 vlan member的区别 答： native-vlan-id只能给接口设置一个vlan号，且这个vlan号是这个接口的默认PVID vlan member可以给这个接口设置多个vlan号，即vlan允许通过列表。例如，当设置native-id为10时，vlan member设置为20，40时，此时vlan列表会有10，20，40。 Vlan member是指这个接口允许通过的vlan列表，只有在此列表中的才会允许通过 ps：当一台交换机设备上有多个vlan时，其中的trunk接口允许通过的列表中有其所有端口的PVID</section></article></main></div>