<!doctype html><html class="dark light"><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><title>
         Storing secrets in a git repository with git-crypt
        
    </title><meta content="Storing secrets in a git repository with git-crypt" property=og:title><meta content="It is possible to store secrets securely in a git repository; here's how" property=og:description><meta content="It is possible to store secrets securely in a git repository; here's how" name=description><link href=/icon/favicon.png rel=icon type=image/png><link href=https://ashang.github.io/zz/fonts.css rel=stylesheet><script>MathJax={tex:{inlineMath:[['$','$'],['\\(','\\)']]}}</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link href=https://ashang.github.io/zz/atom.xml rel=alternate title=atbb type=application/atom+xml><link href=https://ashang.github.io/zz/theme/light.css rel=stylesheet><link href=https://ashang.github.io/zz/theme/dark.css id=darkModeStyle rel=stylesheet><link href=https://ashang.github.io/zz/main.css media=screen rel=stylesheet><body><div class=content><header><div class=main><a href=https://ashang.github.io/zz/>atbb</a><div class=socials><a class=social href=https://github.com/ashang/ rel=me> <img alt=github src=/social_icons/github.svg> </a></div></div><nav><a href=$BASE_URL/search/ style=margin-left:.7em>Search</a><a href=/notes style=margin-left:.7em>/notes</a><a href=/posts style=margin-left:.7em>/posts</a><a href=/gallery style=margin-left:.7em>/gallery</a><a href=/tags style=margin-left:.7em>/tags</a><a href=/projects style=margin-left:.7em>/projects</a> | <a href=javascript:void(0) id=dark-mode-toggle onclick=toggleTheme()> <img id=sun-icon src=/feather/sun.svg style=filter:invert(1)> <img id=moon-icon src=/feather/moon.svg> </a><script src=https://ashang.github.io/zz/js/themetoggle.js></script></nav></header><main><article><div class=title><div class=page-header>Storing secrets in a git repository with git-crypt<span class=primary-color style=font-size:1.6em>.</span></div><div class=meta>Posted on <time>2019-08-18</time></div></div><section class=body><p>One of the most common issues working on a web service is where to store your secrets. When just starting, it's likely that they will be directly in the repository itself whether it happens accidentally or not. Having your production secrets in the clear in the repository is obviously a bad thing and all those secrets should be rotated.<p>There are multiple ways to store your secrets securely:<ul><li>store them in the environment of the servers like Heroku/Aptible do<li>store them as CI/CD variables like in Gitlab and bake them in Docker images<li>use tools like <a href=https://www.vaultproject.io/>Vault</a></ul><p>If you are on a PaaS with an easy way to set secrets as environment variables, you can stop reading this article and just use that.<p>However, if you're a small team using a more traditional deployment encrypting secrets in the repository itself is worth considering. <a href=https://github.com/AGWA/git-crypt>git-crypt</a> can be used for that. To quote the repository:<blockquote><p>git-crypt enables transparent encryption and decryption of files in a git repository. Files which you choose to protect are encrypted when committed, and decrypted when checked out.</blockquote><p><a href=https://github.com/AGWA/git-crypt>git-crypt</a> is available through many package managers.<p>Once you have <code>git-crypt</code> and are in your repository, run <code>git-crypt init</code> to generate a key.<p>The next step is to create a <code>.gitattributes</code>, a file similar to <code>.gitignore</code>, with the following content:<pre class=language-gitignore data-lang=gitignore style=background:#0f1419;color:#bfbab0><code class=language-gitignore data-lang=gitignore><span style=color:#f29718>secrets</span><span style=color:#f29668>/**</span><span style=font-style:italic;color:#5c6773>/* filter=git-crypt diff=git-crypt
</span></code></pre><p>This means that everything inside a folder named <code>secrets</code> will be encrypted. It is recommended to use the <code>**/*</code> approach as it would be easy to forget to encrypt some files otherwise. Now that your <code>.gitattributes</code> file is in place, you can start adding secrets in that folder. Since you have the secrets already unlocked, you will see the file in your <code>git diff</code> or <code>git show</code>. You can check which files are encrypted before pushing by running the <code>git-crypt status -e</code> command:<pre class=language-bash data-lang=bash style=background:#0f1419;color:#bfbab0><code class=language-bash data-lang=bash><span style=font-style:italic;color:#39bae6>~</span><span style=color:#ffb454>/C/p/gitcrypttest</span><span> (master</span><span style=color:#f29668>|</span><span style=color:#ffb454>â€¦</span><span>) </span><span style=color:#ffb454>[1]</span><span> $ git-crypt status</span><span style=color:#f29718> -e
</span><span>    </span><span style=color:#ffb454>encrypted:</span><span> secrets/.envrc
</span></code></pre><p>If you push it to a remote repository and try to view a file in that directory using the web browser for example, you will notice they are just binary data. Anyone getting access to the repository will not be able to see them unless they can unlock git-crypt. That also includes you working from a different computer or your team members.<p>Clearly, we need to be able to unlock the secrets in more than one computer. There are two ways to go about it:<ul><li>GPG<li>creating a symmetric key</ul><p>You can read more about the GPG on the <a href=https://github.com/AGWA/git-crypt#using-git-crypt>git-crypt's README</a>, I will use the symmetric key for this article.<p>Here's how you generate a symmetric key:<pre style=background:#0f1419;color:#bfbab0><code><span>$ git-crypt export-key /path/to/output/file
</span></code></pre><p>This will generate a binary key that, after <code>base64</code>'ing, can be stored in your password manager for example and shared securely with team mates. And that's where the issue with this approach lies: some people might store the key insecurely which would be equivalent to storing your secrets in the clear.<p>For a small team that can be trusted however, this is an easy approach that can work for quite some time!</section></article></main></div>