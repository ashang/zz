<!doctype html><html class="dark light"><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><title>
         Managing environment variables with direnv
        
    </title><meta content="Managing environment variables with direnv" property=og:title><meta content="A direnv introduction and comparison with dotenv" property=og:description><meta content="A direnv introduction and comparison with dotenv" name=description><link href=/icon/favicon.png rel=icon type=image/png><link href=https://ashang.github.io/zz/fonts.css rel=stylesheet><script>MathJax={tex:{inlineMath:[['$','$'],['\\(','\\)']]}}</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link href=https://ashang.github.io/zz/atom.xml rel=alternate title=atbb type=application/atom+xml><link href=https://ashang.github.io/zz/theme/light.css rel=stylesheet><link href=https://ashang.github.io/zz/theme/dark.css id=darkModeStyle rel=stylesheet><link href=https://ashang.github.io/zz/main.css media=screen rel=stylesheet><body><div class=content><header><div class=main><a href=https://ashang.github.io/zz/>atbb</a><div class=socials><a class=social href=https://github.com/ashang/ rel=me> <img alt=github src=/social_icons/github.svg> </a></div></div><nav><a href=$BASE_URL/search/ style=margin-left:.7em>Search</a><a href=/notes style=margin-left:.7em>/notes</a><a href=/posts style=margin-left:.7em>/posts</a><a href=/gallery style=margin-left:.7em>/gallery</a><a href=/tags style=margin-left:.7em>/tags</a><a href=/projects style=margin-left:.7em>/projects</a> | <a href=javascript:void(0) id=dark-mode-toggle onclick=toggleTheme()> <img id=sun-icon src=/feather/sun.svg style=filter:invert(1)> <img id=moon-icon src=/feather/moon.svg> </a><script src=https://ashang.github.io/zz/js/themetoggle.js></script></nav></header><main><article><div class=title><div class=page-header>Managing environment variables with direnv<span class=primary-color style=font-size:1.6em>.</span></div><div class=meta>Posted on <time>2019-05-30</time></div></div><section class=body><p>Following the <a href=https://12factor.net/config>Twelve-Factors app</a>, most web applications are storing configuration in environment variables rather than in a repository. It is possible to store secrets securely in a repository with <a href=https://github.com/AGWA/git-crypt>git-crypt</a> but that will likely be the topic of another article.<p>While in CI and on servers loading those environment variables happen automatically, loading them on your computer is problematic. The most popular approach is <code>dotenv</code>: you store your environment variables in a <code>.env</code> file and a library in your project will look for it and load them. A <code>.env</code> file sample:<pre class=language-bash data-lang=bash style=background:#0f1419;color:#bfbab0><code class=language-bash data-lang=bash><span>REDIS_URL</span><span style=color:#f29668>=</span><span style=color:#c2d94c>blabla
</span><span style=font-style:italic;color:#5c6773># Make sure this is not used in other environments
</span><span>APP_SECRET</span><span style=color:#f29668>=</span><span style=color:#c2d94c>hunter2
</span><span>TRIAL_DAYS_LENGTH</span><span style=color:#f29668>=</span><span style=color:#c2d94c>14
</span></code></pre><p>And, for example in the JavaScript implementation, they can be loaded by adding <code>require('dotenv').config()</code> to your project, as early as possible. As you can see, this adds a dependency to your project that is only used in development: in CI variables are likely to be set in the CI itself and in production by whatever provisioning tool you are using.<p>Enter <a href=https://direnv.net/>direnv</a>.<p>It starts the same way as <code>dotenv</code>: you write your variables in a <code>.envrc</code> file which is almost identical to the example above: entries have an <code>export</code> keyword first.<pre class=language-bash data-lang=bash style=background:#0f1419;color:#bfbab0><code class=language-bash data-lang=bash><span style=color:#ff7733>export </span><span>REDIS_URL</span><span style=color:#f29668>=</span><span style=color:#c2d94c>blabla
</span><span style=font-style:italic;color:#5c6773># Make sure this is not used in other environments
</span><span style=color:#ff7733>export </span><span>APP_SECRET</span><span style=color:#f29668>=</span><span style=color:#c2d94c>hunter2
</span><span style=color:#ff7733>export </span><span>TRIAL_DAYS_LENGTH</span><span style=color:#f29668>=</span><span style=color:#c2d94c>14
</span></code></pre><p>What sets it apart is how it loads the variables. You first need to install <code>direnv</code>, which is a cross-platform binary available on most package managers as well as set up a hook in your bash/zsh/fish config. This might sound complex but you only need to do this setup once per computer and it actually takes less than a minute. The hook is fast enough that it is imperceptible - no need to worry about terminal slowdown.<p>Now that you have the <code>direnv</code> hook, if you <code>cd</code> to a directory with a <code>.envrc</code> you will see:<pre class=language-bash data-lang=bash style=background:#0f1419;color:#bfbab0><code class=language-bash data-lang=bash><span style=color:#ffb454>$</span><span> direnv: error .envrc is blocked. Run `</span><span style=color:#ffb454>direnv</span><span> allow` to approve its content.
</span></code></pre><p>As mentioned in the message, <code>direnv</code> will not automatically load the variables found: you first need to allow the <code>.envrc</code> file. You will need to run <code>direnv allow</code> every time the <code>.envrc</code> is modified. Since <code>direnv</code> loads the variable automatically, this is needed for security as any repo could run commands on your machine otherwise.<p>And that's it you're done. Every time you will <code>cd</code> in a directory, it will automatically load variables found in <code>.envrc</code> and unload them when moving out of the directory:<pre class=language-bash data-lang=bash style=background:#0f1419;color:#bfbab0><code class=language-bash data-lang=bash><span style=color:#ffb454>$</span><span> cd my-repo/
</span><span style=color:#ffb454>direnv:</span><span> loading .envrc
</span><span style=color:#ffb454>direnv:</span><span> export +AWS_ACCESS_KEY_ID +AWS_SECRET_ACCESS_KEY +RUST_LOG +SENTRY_DSN
</span><span>
</span><span style=color:#ffb454>$</span><span> cd ..
</span><span style=color:#ffb454>direnv:</span><span> unloading
</span></code></pre><p>You get the benefits of environment variables for configuration without having to add a dependency to your project. I was actually using <code>direnv</code> before hearing about <code>dotenv</code>: <a href=https://github.com/Keats/dbmigrate/pull/14>https://github.com/Keats/dbmigrate/pull/14</a> and I still don't really see myself using <code>dotenv</code> over it. I'm guessing the advantage of <code>dotenv</code> is if you are launching things from an IDE directly, using Docker or at companies restricting what can be installed on a machine.<p>If this is not your case, I highly recommend <code>direnv</code>.</section></article></main></div>