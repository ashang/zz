<!doctype html><html class="dark light"><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><title>
         使用 Vim 搭建 Kotlin 开发环境
        
    </title><meta content="使用 Vim 搭建 Kotlin 开发环境" property=og:title><meta content="An elegant and understated" property=og:description><meta content="An elegant and understated" name=description><link href=/icon/favicon.png rel=icon type=image/png><link href=https://ashang.github.io/zz/fonts.css rel=stylesheet><script>MathJax={tex:{inlineMath:[['$','$'],['\\(','\\)']]}}</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link href=https://ashang.github.io/zz/atom.xml rel=alternate title=atbb type=application/atom+xml><link href=https://ashang.github.io/zz/theme/light.css rel=stylesheet><link href=https://ashang.github.io/zz/theme/dark.css id=darkModeStyle rel=stylesheet><link href=https://ashang.github.io/zz/main.css media=screen rel=stylesheet><body><div class=content><header><div class=main><a href=https://ashang.github.io/zz/>atbb</a><div class=socials><a class=social href=https://github.com/ashang/ rel=me> <img alt=github src=/social_icons/github.svg> </a></div></div><nav><a href=$BASE_URL/search/ style=margin-left:.7em>Search</a><a href=/notes style=margin-left:.7em>/notes</a><a href=/posts style=margin-left:.7em>/posts</a><a href=/gallery style=margin-left:.7em>/gallery</a><a href=/tags style=margin-left:.7em>/tags</a><a href=/projects style=margin-left:.7em>/projects</a> | <a href=javascript:void(0) id=dark-mode-toggle onclick=toggleTheme()> <img id=sun-icon src=/feather/sun.svg style=filter:invert(1)> <img id=moon-icon src=/feather/moon.svg> </a><script src=https://ashang.github.io/zz/js/themetoggle.js></script></nav></header><main><article><div class=title><div class=page-header>使用 Vim 搭建 Kotlin 开发环境<span class=primary-color style=font-size:1.6em>.</span></div><div class=meta>Posted on <time>2020-09-24</time></div></div><h1>Table of Contents</h1><ul><li><a href=https://ashang.github.io/zz/posts/use-vim-as-a-kotlin-ide/#an-zhuang-mo-kuai>安装模块</a><li><a href=https://ashang.github.io/zz/posts/use-vim-as-a-kotlin-ide/#dai-ma-zi-dong-bu-quan>代码自动补全</a><li><a href=https://ashang.github.io/zz/posts/use-vim-as-a-kotlin-ide/#yu-fa-jian-cha>语法检查</a><li><a href=https://ashang.github.io/zz/posts/use-vim-as-a-kotlin-ide/#gong-cheng-wen-jian-tiao-zhuan>工程文件跳转</a><li><a href=https://ashang.github.io/zz/posts/use-vim-as-a-kotlin-ide/#kuai-su-yun-xing>快速运行</a><li><a href=https://ashang.github.io/zz/posts/use-vim-as-a-kotlin-ide/#dai-ma-ge-shi-hua>代码格式化</a><li><a href=https://ashang.github.io/zz/posts/use-vim-as-a-kotlin-ide/#jiao-hu-shi-bian-cheng>交互式编程</a><li><a href=https://ashang.github.io/zz/posts/use-vim-as-a-kotlin-ide/#ren-wu-guan-li>任务管理</a></ul><section class=body><h3 id=an-zhuang-mo-kuai>安装模块</h3><p>SpaceVim 初次安装时默认并未启用相关语言模块。因此，首先需要启用 <code>lang#kotlin</code> 模块，通过快捷键 <code>SPC f v d</code> 打开配置文件，添加如下片断：<pre class=language-toml data-lang=toml style=background:#0f1419;color:#bfbab0><code class=language-toml data-lang=toml><span>[[</span><span style=color:#59c2ff>layers</span><span>]]
</span><span>  </span><span style=color:#59c2ff>name </span><span>= </span><span style=color:#c2d94c>"lang#kotlin"
</span></code></pre><p>启用 <code>lang#kotlin</code> 模块后，在打开 Kotlin 文件时，就可以使用语言专属快捷键，这些快捷键都是以 <code>SPC l</code> 为前缀的。<h3 id=dai-ma-zi-dong-bu-quan>代码自动补全</h3><p><code>autocomplete</code> 模块为 SpaceVim 提供了自动补全功能，目前针对 Kotlin 而言，比较好的补全方案是配合使用 lsp 模块：<pre class=language-toml data-lang=toml style=background:#0f1419;color:#bfbab0><code class=language-toml data-lang=toml><span>[[</span><span style=color:#59c2ff>layers</span><span>]]
</span><span>  </span><span style=color:#59c2ff>name </span><span>= </span><span style=color:#c2d94c>'lsp'
</span><span>  </span><span style=color:#59c2ff>filetypes </span><span>= [
</span><span>    </span><span style=color:#c2d94c>'kotlin'</span><span style=color:#bfbab0cc>,
</span><span>  ]
</span></code></pre><p>lsp 模块默认使用 <code>kotlin-language-server</code> 作为 Kotlin 的语言服务器后台命令，首先需要安装 kotlin-language-server. 如果 <code>kotlin-language-server</code> 这一命令不在 <code>$PATH</code> 内，可以修改 kotlin 语言服务器命令为完整路径：<pre class=language-toml data-lang=toml style=background:#0f1419;color:#bfbab0><code class=language-toml data-lang=toml><span>[[</span><span style=color:#59c2ff>layers</span><span>]]
</span><span>  </span><span style=color:#59c2ff>name </span><span>= </span><span style=color:#c2d94c>'lsp'
</span><span>  </span><span style=color:#59c2ff>filetypes </span><span>= [
</span><span>    </span><span style=color:#c2d94c>'kotlin'</span><span style=color:#bfbab0cc>,
</span><span>  ]
</span><span>  [</span><span style=color:#59c2ff>layers</span><span style=color:#bfbab0cc>.</span><span style=color:#59c2ff>override_cmd</span><span>]
</span><span>    </span><span style=color:#59c2ff>kotlin </span><span>= </span><span style=color:#c2d94c>'path/to/kotlin-language-server'
</span></code></pre><h3 id=yu-fa-jian-cha>语法检查</h3><p><code>checkers</code> 模块为 SpaceVim 提供了语法检查的功能，该模块默认已经载入。该模块默认使用 <a href=https://github.com/neomake/neomake>neomake</a> 这一异步语法检查工具。对于 Kotlin 的支持，是通过异步调用 <a href=https://github.com/pinterest/ktlint>ktlint</a> 命令来完成的。<p>在 Window 系统下，可以使用 <a href=https://github.com/lukesampson/scoop>scoop</a> 安装 ktlint：<pre style=background:#0f1419;color:#bfbab0><code><span>scoop install ktlint
</span></code></pre><p><img alt=kotlin-lint src=https://user-images.githubusercontent.com/13142418/94366839-3e846a00-010d-11eb-9e6c-200931646479.png><h3 id=gong-cheng-wen-jian-tiao-zhuan>工程文件跳转</h3><p>SpaceVim 自带工程管理插件，可以识别项目根目录，自动跳转 alternate 文件。需要在项目根目录添加工程文件 <code>.project_alt.json</code>：<pre class=language-json data-lang=json style=background:#0f1419;color:#bfbab0><code class=language-json data-lang=json><span>{
</span><span>  </span><span style=color:#c2d94c>"src/*.kt"</span><span style=color:#bfbab0cc>: </span><span>{ </span><span style=color:#c2d94c>"alternate"</span><span style=color:#bfbab0cc>: </span><span style=color:#c2d94c>"test/{}.kt" </span><span>}</span><span style=color:#bfbab0cc>,
</span><span>  </span><span style=color:#c2d94c>"test/*.kt"</span><span style=color:#bfbab0cc>: </span><span>{ </span><span style=color:#c2d94c>"alternate"</span><span style=color:#bfbab0cc>: </span><span style=color:#c2d94c>"src/{}.kt" </span><span>}
</span><span>}
</span></code></pre><p>通过以上的配置，就可以使用命令 <code>:A</code> 在源文件和测试文件之间进行跳转。<h3 id=kuai-su-yun-xing>快速运行</h3><p>在编辑 <code>kotlin</code> 文件时，可以快速运行当前文件，这个功能有点类似于 vscode 的 code runner 插件，默认的快捷键是 <code>SPC l r</code> 。按下后， 会在屏幕下方打开一个插件窗口，运行的结果会被展示在窗口内。于此同时，光标并不会跳到该插件窗口，避免影响编辑。在这里需要说明下， 这一功能是根据当前 buffer 内容调用 Kotlin 命令。因此，在执行这个快捷键之前，不一定要保存该文件。<p><img alt=kotlin-runner src=https://user-images.githubusercontent.com/13142418/94288524-14566f00-ff8a-11ea-8440-ee9ca8ba8843.png><h3 id=dai-ma-ge-shi-hua>代码格式化</h3><p>Kotlin 代码格式化，主要依赖 <code>format</code> 模块，同时需要安装相关的后台命令 <a href=https://prettier.io/>prettier</a>，默认快捷键为 <code>SPC b f</code> ：<pre class=language-toml data-lang=toml style=background:#0f1419;color:#bfbab0><code class=language-toml data-lang=toml><span>[[</span><span style=color:#59c2ff>layers</span><span>]]
</span><span>  </span><span style=color:#59c2ff>name </span><span>= </span><span style=color:#c2d94c>"format"
</span></code></pre><p>使用 npm 安装 prettier：<pre style=background:#0f1419;color:#bfbab0><code><span>npm install --save-dev --save-exact prettier
</span></code></pre><h3 id=jiao-hu-shi-bian-cheng>交互式编程</h3><p>在编辑 Kotlin 文件时，可通过快捷键 <code>SPC l s i</code> 启动 <code>kotlinc-jvm</code> 交互窗口， 之后使用快捷键将代码发送至解释器。默认快捷键都以 <code>SPC l s</code> 为前缀。<p><img alt=kotlin-repl src=https://user-images.githubusercontent.com/13142418/94289606-84192980-ff8b-11ea-84c8-1547741f377c.png><h3 id=ren-wu-guan-li>任务管理</h3><p>在项目根目录新建 <code>.SpaceVim.d/task.toml</code> 文件，将常用的任务命令加入其中，示例如下：<pre class=language-toml data-lang=toml style=background:#0f1419;color:#bfbab0><code class=language-toml data-lang=toml><span>[</span><span style=color:#59c2ff>gradle-build</span><span>]
</span><span>    </span><span style=color:#59c2ff>command </span><span>= </span><span style=color:#c2d94c>'gradlew'
</span><span>    </span><span style=color:#59c2ff>args </span><span>= [</span><span style=color:#c2d94c>'build'</span><span>]
</span></code></pre><p>更多关于任务管理的配置教程，可以阅读 <a href=../documentation/#%E4%BB%BB%E5%8A%A1%E7%AE%A1%E7%90%86>task 文档</a><p>这篇文章还未完结，新的内容后续会继续更新，如果想要帮助改善这篇文章， 可以加入 <a href=https://gitter.im/SpaceVim/cn>SpaceVim 中文聊天室</a> 一起交流。</section></article></main></div>