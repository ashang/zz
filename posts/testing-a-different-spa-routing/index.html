<!doctype html><html class="dark light"><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><title>
         A different approach to routing in Single-Page Applications
        
    </title><meta content="A different approach to routing in Single-Page Applications" property=og:title><meta content="Trying out a framework agnostic approach to routing for SPA" property=og:description><meta content="Trying out a framework agnostic approach to routing for SPA" name=description><link href=/icon/favicon.png rel=icon type=image/png><link href=https://ashang.github.io/zz/fonts.css rel=stylesheet><script>MathJax={tex:{inlineMath:[['$','$'],['\\(','\\)']]}}</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link href=https://ashang.github.io/zz/atom.xml rel=alternate title=atbb type=application/atom+xml><link href=https://ashang.github.io/zz/theme/light.css rel=stylesheet><link href=https://ashang.github.io/zz/theme/dark.css id=darkModeStyle rel=stylesheet><link href=https://ashang.github.io/zz/main.css media=screen rel=stylesheet><body><div class=content><header><div class=main><a href=https://ashang.github.io/zz/>atbb</a><div class=socials><a class=social href=https://github.com/ashang/ rel=me> <img alt=github src=/social_icons/github.svg> </a></div></div><nav><a href=$BASE_URL/search/ style=margin-left:.7em>Search</a><a href=/notes style=margin-left:.7em>/notes</a><a href=/posts style=margin-left:.7em>/posts</a><a href=/gallery style=margin-left:.7em>/gallery</a><a href=/tags style=margin-left:.7em>/tags</a><a href=/projects style=margin-left:.7em>/projects</a> | <a href=javascript:void(0) id=dark-mode-toggle onclick=toggleTheme()> <img id=sun-icon src=/feather/sun.svg style=filter:invert(1)> <img id=moon-icon src=/feather/moon.svg> </a><script src=https://ashang.github.io/zz/js/themetoggle.js></script></nav></header><main><article><div class=title><div class=page-header>A different approach to routing in Single-Page Applications<span class=primary-color style=font-size:1.6em>.</span></div><div class=meta>Posted on <time>2017-05-08</time></div></div><h1>Table of Contents</h1><ul><li><a href=https://ashang.github.io/zz/posts/testing-a-different-spa-routing/#the-problem>The problem</a><li><a href=https://ashang.github.io/zz/posts/testing-a-different-spa-routing/#the-solution>The solution</a> <ul><li><a href=https://ashang.github.io/zz/posts/testing-a-different-spa-routing/#routing-setup>Routing setup</a><li><a href=https://ashang.github.io/zz/posts/testing-a-different-spa-routing/#integrating-react>Integrating React</a></ul><li><a href=https://ashang.github.io/zz/posts/testing-a-different-spa-routing/#the-end>The end</a></ul><section class=body><p>Routing is a big part of most SPA:<ul><li>what to render when a user hits a certain URL<li>whether the user is allowed to reach that page<li>what data do we need to load before rendering<li>eventually display some loading screen if necessary.</ul><h2 id=the-problem>The problem</h2><p>In the React world, <a href=https://github.com/ReactTraining/react-router>React-Router</a> is the standard. It is a bit infamous as its API has changed drastically for each major version. Proppy is still using v2 as updating it didn't seem to bring much benefit and would take time. Our only issue with our current setup is that we are not able to make the async transitions the way we would like them to be, but it is an annoying one from a UX point of view.<p>After reading <a href=https://hackernoon.com/how-to-decouple-state-and-ui-a-k-a-you-dont-need-componentwillmount-cc90b787aa37>How to decouple state and UI (a.k.a. you donâ€™t need componentWillMount)</a> by the author of <a href=https://mobx.js.org>MobX</a>, I realised that routing should be something that is framework-agnostic. After all, isn't routing simply matching a URL state to a function? There is no need for something specific to React, Angular or anything else.<p>I recently started experimenting with it and I think I found a nice setup. I haven't tried it for a complex app yet though so it is probably lacking in some ways. I will write another article on how it works in a real app when I have the time to try it in Proppy.<h2 id=the-solution>The solution</h2><p>This example will use React, MobX and <a href=http://router5.github.io/>router5</a>. router5 is a nice router library that treats routing state like any application state. Combined with MobX, you can have a store that will contain the routing state trivially without any framework. I couldn't find an up to date TypeScript definition for router5 so I <a href=https://gist.github.com/Keats/1b8833b581d01e751048e1f51041817f>made one</a>. I'm not entirely sure whether this is the correct way to write a definition file though so I will wait a bit before making a PR to <a href=https://github.com/DefinitelyTyped/DefinitelyTyped/>DefinitelyTyped</a>.<h3 id=routing-setup>Routing setup</h3><p>Let's take a very simple routing scheme:<pre class=language-tsx data-lang=tsx style=background:#0f1419;color:#bfbab0><code class=language-tsx data-lang=tsx><span style=color:#ff7733>const </span><span>routes</span><span style=color:#f29668>: </span><span style=color:#59c2ff>Array</span><span><</span><span style=font-style:italic;color:#39bae6>object</span><span>> </span><span style=color:#f29668>= </span><span>[
</span><span>  </span><span style=font-style:italic;color:#5c6773>// Logged-in routes
</span><span>  {name</span><span style=color:#bfbab0cc>: </span><span style=color:#c2d94c>"home"</span><span style=color:#bfbab0cc>, </span><span>path</span><span style=color:#bfbab0cc>: </span><span style=color:#c2d94c>"/"</span><span style=color:#bfbab0cc>, </span><span>canActivate</span><span style=color:#bfbab0cc>: </span><span>loggedInRequired</span><span style=color:#bfbab0cc>, </span><span>onActivate</span><span style=color:#bfbab0cc>: </span><span>dashboardStore</span><span style=color:#f29668>.</span><span>fetch}</span><span style=color:#bfbab0cc>,
</span><span>
</span><span>  </span><span style=font-style:italic;color:#5c6773>// Logged-out routes
</span><span>  {name</span><span style=color:#bfbab0cc>: </span><span style=color:#c2d94c>"signin"</span><span style=color:#bfbab0cc>, </span><span>path</span><span style=color:#bfbab0cc>: </span><span style=color:#c2d94c>"/signin"</span><span>}</span><span style=color:#bfbab0cc>,
</span><span>  {name</span><span style=color:#bfbab0cc>: </span><span style=color:#c2d94c>"signup"</span><span style=color:#bfbab0cc>, </span><span>path</span><span style=color:#bfbab0cc>: </span><span style=color:#c2d94c>"/signup"</span><span>}</span><span style=color:#bfbab0cc>,
</span><span>  {name</span><span style=color:#bfbab0cc>: </span><span style=color:#c2d94c>"forgot-password"</span><span style=color:#bfbab0cc>, </span><span>path</span><span style=color:#bfbab0cc>: </span><span style=color:#c2d94c>"/forgot-password"</span><span>}</span><span style=color:#bfbab0cc>,
</span><span>]</span><span style=color:#bfbab0cc>;
</span><span>
</span><span style=color:#ff7733>export type </span><span style=color:#59c2ff>Routes </span><span style=color:#f29668>=
</span><span>  </span><span style=color:#c2d94c>"home"
</span><span>  </span><span style=color:#f29668>| </span><span style=color:#c2d94c>"signin"
</span><span>  </span><span style=color:#f29668>| </span><span style=color:#c2d94c>"signup"
</span><span>  </span><span style=color:#f29668>| </span><span style=color:#c2d94c>"forgot-password"
</span><span style=color:#bfbab0cc>;
</span></code></pre><p>As you can see, nothing magical going on: <code>routes</code> is simply an array of routes, which are plain JavaScript objects themselves. The <code>Routes</code> type has to be manually updated to match the routes but allows compile-time checking of the routes: a worthy trade-off in my eyes.<p>The <code>canActivate</code> key corresponds to a <a href=http://router5.github.io/docs/preventing-navigation.html>lifecycle function</a> of router5. router5 will call this function before transitioning to the new state, preventing the transition if necessary. In that case it is simply the following:<pre class=language-tsx data-lang=tsx style=background:#0f1419;color:#bfbab0><code class=language-tsx data-lang=tsx><span style=color:#ff7733>const </span><span style=color:#ffb454>loggedInRequired </span><span style=color:#f29668>= </span><span>() </span><span style=color:#ff7733>=> </span><span>(</span><span style=color:#f29718>toState</span><span style=color:#f29668>: </span><span style=color:#59c2ff>State</span><span style=color:#bfbab0cc>, </span><span style=color:#f29718>fromState</span><span style=color:#f29668>: </span><span style=color:#59c2ff>State</span><span style=color:#bfbab0cc>, </span><span style=color:#f29718>done</span><span style=color:#f29668>: </span><span style=font-style:italic;color:#39bae6>any</span><span>) </span><span style=color:#ff7733>=> </span><span>{
</span><span>  </span><span style=font-style:italic;color:#5c6773>// userIsLoggedIn can be whatever you need it to be
</span><span>  </span><span style=color:#ff7733>if </span><span>(</span><span style=color:#ffb454>userIsLoggedIn</span><span>()) {
</span><span>    </span><span style=color:#ff7733>return </span><span style=color:#f29718>true</span><span style=color:#bfbab0cc>;
</span><span>  } </span><span style=color:#ff7733>else </span><span>{
</span><span>    </span><span style=font-style:italic;color:#5c6773>// redirect to signin page if the user isn't logged in
</span><span>    </span><span style=color:#ffb454>done</span><span>({redirect</span><span style=color:#bfbab0cc>: </span><span>{name</span><span style=color:#bfbab0cc>: </span><span style=color:#c2d94c>"signin"</span><span>}})</span><span style=color:#bfbab0cc>;
</span><span>  }
</span><span>}</span><span style=color:#bfbab0cc>;
</span></code></pre><p><code>onActivate</code> will be explained in a bit.<p>Before looking at the router setup, let's have a quick look at the MobX router store:<pre class=language-tsx data-lang=tsx style=background:#0f1419;color:#bfbab0><code class=language-tsx data-lang=tsx><span style=color:#ff7733>import </span><span>{action</span><span style=color:#bfbab0cc>, </span><span>observable} </span><span style=color:#ff7733>from </span><span style=color:#c2d94c>"mobx"</span><span style=color:#bfbab0cc>;
</span><span style=color:#ff7733>import </span><span>{State} </span><span style=color:#ff7733>from </span><span style=color:#c2d94c>"router5"</span><span style=color:#bfbab0cc>;
</span><span>
</span><span style=color:#ff7733>class </span><span style=color:#59c2ff>RouterStore </span><span>{
</span><span>  @observable current</span><span style=color:#f29668>: </span><span style=color:#59c2ff>State</span><span style=color:#bfbab0cc>;
</span><span>  @observable asyncInProgress </span><span style=color:#f29668>= </span><span style=color:#f29718>false</span><span style=color:#bfbab0cc>;
</span><span>
</span><span>  </span><span style=font-style:italic;color:#5c6773>// Called after transition
</span><span>  @action </span><span style=color:#ffb454>setCurrent</span><span>(</span><span style=color:#f29718>state</span><span style=color:#f29668>: </span><span style=color:#59c2ff>State</span><span>) {
</span><span>    </span><span style=font-style:italic;color:#39bae6>this</span><span style=color:#f29668>.</span><span>current </span><span style=color:#f29668>= </span><span>state</span><span style=color:#bfbab0cc>;
</span><span>    </span><span style=font-style:italic;color:#39bae6>this</span><span style=color:#f29668>.</span><span>asyncInProgress </span><span style=color:#f29668>= </span><span style=color:#f29718>false</span><span style=color:#bfbab0cc>;
</span><span>  }
</span><span>
</span><span>  @action </span><span style=color:#ffb454>startAsyncLoading</span><span>() {
</span><span>    </span><span style=font-style:italic;color:#39bae6>this</span><span style=color:#f29668>.</span><span>asyncInProgress </span><span style=color:#f29668>= </span><span style=color:#f29718>true</span><span style=color:#bfbab0cc>;
</span><span>  }
</span><span>}
</span><span>
</span><span style=color:#ff7733>const </span><span>routerStore </span><span style=color:#f29668>= new </span><span style=color:#59c2ff>RouterStore</span><span>()</span><span style=color:#bfbab0cc>;
</span><span style=color:#ff7733>export default </span><span>routerStore</span><span style=color:#bfbab0cc>;
</span></code></pre><p>If you haven't used MobX before, I heavily recommend it and <a href=https://ashang.github.io/zz/posts/testing-a-different-spa-routing/2016-11-01_a-mobx-introduction/index.md>wrote an introduction to it</a> before. In a nutshell, think of the code above as a simple class that has 2 observable values: <code>current</code> and <code>asyncInProgress</code>.<p>Ok we got our routes and store, we now need to create a router:<pre class=language-tsx data-lang=tsx style=background:#0f1419;color:#bfbab0><code class=language-tsx data-lang=tsx><span style=font-style:italic;color:#5c6773>// Router setup
</span><span style=color:#ff7733>const </span><span>router </span><span style=color:#f29668>= </span><span style=color:#ffb454>createRouter</span><span>(routes)</span><span style=color:#bfbab0cc>;
</span><span>router</span><span style=color:#f29668>.</span><span style=color:#ffb454>usePlugin</span><span>(</span><span style=color:#ffb454>browserPlugin</span><span>()</span><span style=color:#bfbab0cc>, </span><span>mobxRouterPlugin)</span><span style=color:#bfbab0cc>;
</span><span>router</span><span style=color:#f29668>.</span><span style=color:#ffb454>useMiddleware</span><span>(</span><span style=color:#ffb454>asyncMiddleware</span><span>(routes))</span><span style=color:#bfbab0cc>;
</span><span>router</span><span style=color:#f29668>.</span><span style=color:#ffb454>start</span><span>()</span><span style=color:#bfbab0cc>;
</span></code></pre><p>This does a few things. First we create a router using the routes we defined above. We then add 2 plugins:<ul><li><code>browser</code>: a built-in plugin that will update the browser URL and state on route change using the HTML5 history API<li><code>mobxRouterPlugin</code>: a very simple custom made plugin shown below that will upate the store on transition success and error</ul><pre class=language-tsx data-lang=tsx style=background:#0f1419;color:#bfbab0><code class=language-tsx data-lang=tsx><span style=color:#ff7733>import </span><span>routerStore </span><span style=color:#ff7733>from </span><span style=color:#c2d94c>"./stores/router"</span><span style=color:#bfbab0cc>;
</span><span>
</span><span style=font-style:italic;color:#5c6773>// Tell MobX which page we're on
</span><span style=color:#ff7733>export function </span><span style=color:#ffb454>mobxRouterPlugin</span><span>(</span><span style=color:#f29718>router</span><span style=color:#f29668>: </span><span style=color:#59c2ff>Router</span><span>) {
</span><span>  </span><span style=color:#ff7733>return </span><span>{
</span><span>    </span><span style=color:#ffb454>onTransitionError</span><span style=color:#bfbab0cc>: </span><span>(</span><span style=color:#f29718>toState</span><span style=color:#f29668>: </span><span style=color:#59c2ff>State</span><span>) </span><span style=color:#ff7733>=> </span><span>{
</span><span>      </span><span style=font-style:italic;color:#5c6773>// TODO handle that.
</span><span>    }</span><span style=color:#bfbab0cc>,
</span><span>    </span><span style=color:#ffb454>onTransitionSuccess</span><span style=color:#bfbab0cc>: </span><span>(</span><span style=color:#f29718>toState</span><span style=color:#f29668>: </span><span style=color:#59c2ff>State</span><span>) </span><span style=color:#ff7733>=> </span><span>{
</span><span>      routerStore</span><span style=color:#f29668>.</span><span style=color:#ffb454>setCurrent</span><span>(toState)</span><span style=color:#bfbab0cc>;
</span><span>    }</span><span style=color:#bfbab0cc>,
</span><span>  }</span><span style=color:#bfbab0cc>;
</span><span>}
</span><span>(mobxRouterPlugin </span><span style=color:#ff7733>as </span><span style=color:#59c2ff>PluginFactory</span><span>)</span><span style=color:#f29668>.</span><span>pluginName </span><span style=color:#f29668>= </span><span style=color:#c2d94c>"MOBX_PLUGIN"</span><span style=color:#bfbab0cc>;
</span></code></pre><p>How errors are handled is really up to you, I'm focusing on the happy path for that article.<p>Next up is the <code>asyncMiddleware</code> that handles any pre-loading we need to do. If a <code>onActivate</code> function on a route is found a route, it assumes it is an async call that returns a promise:<pre class=language-tsx data-lang=tsx style=background:#0f1419;color:#bfbab0><code class=language-tsx data-lang=tsx><span style=color:#ff7733>const </span><span style=color:#ffb454>asyncMiddleware </span><span style=color:#f29668>= </span><span>(</span><span style=color:#f29718>routes</span><span style=color:#f29668>: </span><span style=color:#59c2ff>Array</span><span><</span><span style=font-style:italic;color:#39bae6>any</span><span>>) </span><span style=color:#ff7733>=> </span><span>(</span><span style=color:#f29718>router</span><span style=color:#f29668>: </span><span style=color:#59c2ff>Router</span><span>) </span><span style=color:#ff7733>=> </span><span>(</span><span style=color:#f29718>toState</span><span style=color:#f29668>: </span><span style=font-style:italic;color:#39bae6>any</span><span style=color:#bfbab0cc>, </span><span style=color:#f29718>fromState</span><span style=color:#f29668>: </span><span style=color:#59c2ff>State</span><span style=color:#bfbab0cc>, </span><span style=color:#f29718>done</span><span style=color:#f29668>: </span><span style=font-style:italic;color:#39bae6>any</span><span>) </span><span style=color:#ff7733>=> </span><span>{
</span><span>  </span><span style=color:#ff7733>const </span><span>route </span><span style=color:#f29668>= </span><span>routes</span><span style=color:#f29668>.</span><span style=color:#f07178>find</span><span>((</span><span style=color:#f29718>r</span><span>) </span><span style=color:#ff7733>=> </span><span>r</span><span style=color:#f29668>.</span><span>name </span><span style=color:#f29668>=== </span><span>toState</span><span style=color:#f29668>.</span><span>name)</span><span style=color:#bfbab0cc>;
</span><span>  </span><span style=font-style:italic;color:#5c6773>// do we have a function to call?
</span><span>  </span><span style=color:#ff7733>if </span><span>(route</span><span style=color:#f29668>.</span><span>onActivate) {
</span><span>    </span><span style=font-style:italic;color:#5c6773>// Tell the store that will load something, might want to have some visual loading effect
</span><span>    routerStore</span><span style=color:#f29668>.</span><span style=color:#ffb454>startAsyncLoading</span><span>()</span><span style=color:#bfbab0cc>;
</span><span>    </span><span style=color:#ff7733>return </span><span>route</span><span style=color:#f29668>.</span><span style=color:#f07178>onActivate</span><span>(toState</span><span style=color:#f29668>.</span><span>params)
</span><span>      </span><span style=color:#f29668>.</span><span style=color:#f07178>then</span><span>((</span><span style=color:#f29718>res</span><span style=color:#f29668>: </span><span style=font-style:italic;color:#39bae6>any</span><span>) </span><span style=color:#ff7733>=> </span><span>{
</span><span>        </span><span style=font-style:italic;color:#5c6773>// Fail the transition if the call failed
</span><span>        </span><span style=color:#ff7733>if </span><span>(res</span><span style=color:#f29668>.</span><span>error) {
</span><span>          </span><span style=color:#ff7733>return </span><span style=color:#ffb454>done</span><span>({code</span><span style=color:#bfbab0cc>: </span><span style=color:#c2d94c>"TRANSITION_ERR"</span><span style=color:#bfbab0cc>, </span><span>error</span><span style=color:#bfbab0cc>: </span><span>res})</span><span style=color:#bfbab0cc>;
</span><span>        }
</span><span>      })</span><span style=color:#bfbab0cc>;
</span><span>  }
</span><span>  </span><span style=color:#ffb454>done</span><span>()</span><span style=color:#bfbab0cc>;
</span><span>}</span><span style=color:#bfbab0cc>;
</span></code></pre><p>In practice, the <code>onActivate</code> method of the <code>home</code> route will be called before transitioning and will only be completed if the call succeeded. The store will automatically be notified of the start of an async call and of any successful transition: displaying a loading progress becomes straightforward.<p>Finally, we start the router which will automatically use the current URL as the current state as we are using the Browser plugin.<h3 id=integrating-react>Integrating React</h3><p>Now that we have the routing is up and running, we need to be able to render components depending on the URL and navigate between pages. Since all the routing state is in a MobX store, this is simply a matter of having a component observe it:<pre class=language-tsx data-lang=tsx style=background:#0f1419;color:#bfbab0><code class=language-tsx data-lang=tsx><span>@observer
</span><span style=color:#ff7733>class </span><span style=color:#59c2ff>App </span><span style=color:#ff7733>extends </span><span style=color:#59c2ff>React</span><span style=color:#f29668>.</span><span style=text-decoration:underline;color:#59c2ff>Component</span><span><{}</span><span style=color:#bfbab0cc>, </span><span>{}> {
</span><span>  </span><span style=color:#ffb454>render</span><span>() {
</span><span>    </span><span style=color:#ff7733>if </span><span>(routerStore</span><span style=color:#f29668>.</span><span>current </span><span style=color:#f29668>=== </span><span style=color:#f29718>null</span><span>) {
</span><span>      </span><span style=color:#ff7733>return </span><span style=color:#f29718>null</span><span style=color:#bfbab0cc>;
</span><span>    }
</span><span>
</span><span>    </span><span style=color:#ff7733>let </span><span>component </span><span style=color:#f29668>= </span><span style=color:#f29718>null</span><span style=color:#bfbab0cc>;
</span><span>    </span><span style=color:#ff7733>switch </span><span>(routerStore</span><span style=color:#f29668>.</span><span>current</span><span style=color:#f29668>.</span><span>name </span><span style=color:#ff7733>as </span><span style=color:#59c2ff>Routes</span><span>) {
</span><span>      </span><span style=color:#ff7733>case </span><span style=color:#c2d94c>"signup"</span><span>:
</span><span>        component </span><span style=color:#f29668>= </span><span style=color:#39bae690><</span><span style=font-style:italic;color:#39bae6>SignUp </span><span style=color:#39bae690>/></span><span style=color:#bfbab0cc>;
</span><span>        </span><span style=color:#ff7733>break</span><span style=color:#bfbab0cc>;
</span><span>      </span><span style=color:#ff7733>case </span><span style=color:#c2d94c>"signin"</span><span>:
</span><span>        component </span><span style=color:#f29668>= </span><span style=color:#39bae690><</span><span style=font-style:italic;color:#39bae6>SignIn </span><span style=color:#39bae690>/></span><span style=color:#bfbab0cc>;
</span><span>        </span><span style=color:#ff7733>break</span><span style=color:#bfbab0cc>;
</span><span>      </span><span style=color:#ff7733>case </span><span style=color:#c2d94c>"forgot-password"</span><span>:
</span><span>        component </span><span style=color:#f29668>= </span><span style=color:#39bae690><</span><span style=font-style:italic;color:#39bae6>ForgotPassword </span><span style=color:#39bae690>/></span><span style=color:#bfbab0cc>;
</span><span>        </span><span style=color:#ff7733>break</span><span style=color:#bfbab0cc>;
</span><span>    }
</span><span>    </span><span style=font-style:italic;color:#5c6773>// A 404 would be quite blank.
</span><span>    </span><span style=color:#ff7733>return </span><span>(
</span><span>      </span><span style=color:#39bae690><</span><span style=color:#59c2ff>div </span><span style=color:#ffb454>className</span><span style=color:#f29668>=</span><span style=color:#c2d94c>"app-container"</span><span style=color:#39bae690>>
</span><span>        {component}
</span><span>      </span><span style=color:#39bae690>&LT/</span><span style=color:#59c2ff>div</span><span style=color:#39bae690>>
</span><span>    )</span><span style=color:#bfbab0cc>;
</span><span>  }
</span></code></pre><p>That's it. A simple switch on the name of the current route and we're good to go.<p>There is a small twist for links though: using a basic <code>&LTa href="/forgot-password">Forgot?&LT/a></code> will trigger a full reload, unless there's an option I missed. You will need to use the <code>router.navigate</code> method to navigate instead. If you are using React you might have a <code>Link</code> component in your project to standardize how links are made and the various styles it can have. Here's an example for a basic one:<pre class=language-tsx data-lang=tsx style=background:#0f1419;color:#bfbab0><code class=language-tsx data-lang=tsx><span style=color:#ff7733>export interface </span><span style=color:#59c2ff>ILinkProps </span><span>{
</span><span>  name</span><span style=color:#f29668>: </span><span style=color:#59c2ff>Routes</span><span style=color:#bfbab0cc>;
</span><span>  params</span><span style=color:#f29668>?: </span><span style=font-style:italic;color:#39bae6>object</span><span style=color:#bfbab0cc>;
</span><span>  options</span><span style=color:#f29668>?: </span><span>{reload</span><span style=color:#f29668>: </span><span style=font-style:italic;color:#39bae6>boolean</span><span style=color:#bfbab0cc>, </span><span>refresh</span><span style=color:#f29668>: </span><span style=font-style:italic;color:#39bae6>boolean</span><span>}</span><span style=color:#bfbab0cc>;
</span><span>}
</span><span>
</span><span style=color:#ff7733>class </span><span style=color:#59c2ff>Link </span><span style=color:#ff7733>extends </span><span style=color:#59c2ff>React</span><span style=color:#f29668>.</span><span style=text-decoration:underline;color:#59c2ff>Component</span><span><</span><span style=color:#59c2ff>ILinkProps</span><span style=color:#bfbab0cc>, </span><span>{}> {
</span><span>  </span><span style=color:#ff7733>protected static </span><span>defaultProps </span><span style=color:#f29668>= </span><span>{
</span><span>    options</span><span style=color:#bfbab0cc>: </span><span>{}</span><span style=color:#bfbab0cc>,
</span><span>    params</span><span style=color:#bfbab0cc>: </span><span>{}</span><span style=color:#bfbab0cc>,
</span><span>  }</span><span style=color:#bfbab0cc>;
</span><span>
</span><span>  </span><span style=color:#ffb454>render</span><span>() {
</span><span>    </span><span style=color:#ff7733>const </span><span>{name</span><span style=color:#bfbab0cc>, </span><span>params} </span><span style=color:#f29668>= </span><span style=font-style:italic;color:#39bae6>this</span><span style=color:#f29668>.</span><span>props</span><span style=color:#bfbab0cc>;
</span><span>
</span><span>    </span><span style=font-style:italic;color:#5c6773>// Build the end url
</span><span>    </span><span style=color:#ff7733>const </span><span>href </span><span style=color:#f29668>= </span><span>router</span><span style=color:#f29668>.</span><span style=color:#ffb454>buildPath</span><span>(name</span><span style=color:#bfbab0cc>, </span><span>params </span><span style=color:#ff7733>as </span><span style=font-style:italic;color:#39bae6>any</span><span>)</span><span style=color:#bfbab0cc>;
</span><span>    </span><span style=color:#ff7733>if </span><span>(href </span><span style=color:#f29668>=== </span><span style=color:#f29718>null</span><span>) {
</span><span>      </span><span style=font-style:italic;color:#5c6773>// tslint:disable-next-line
</span><span>      </span><span style=font-style:italic;color:#39bae6>console</span><span style=color:#f29668>.</span><span style=color:#f07178>error</span><span>(</span><span style=color:#c2d94c>"&LTLink> Couldn't make URL for"</span><span style=color:#bfbab0cc>, </span><span>name</span><span style=color:#bfbab0cc>, </span><span>params)</span><span style=color:#bfbab0cc>;
</span><span>    }
</span><span>
</span><span>    </span><span style=color:#ff7733>return </span><span>(
</span><span>      </span><span style=color:#39bae690><</span><span style=color:#59c2ff>a </span><span style=color:#ffb454>href</span><span style=color:#f29668>=</span><span>{href} </span><span style=color:#ffb454>onClick</span><span style=color:#f29668>=</span><span>{</span><span style=font-style:italic;color:#39bae6>this</span><span style=color:#f29668>.</span><span>onClick</span><span style=color:#f29668>.</span><span style=color:#ffb454>bind</span><span>(</span><span style=font-style:italic;color:#39bae6>this</span><span>)}</span><span style=color:#39bae690>>
</span><span>        {</span><span style=font-style:italic;color:#39bae6>this</span><span style=color:#f29668>.</span><span>props</span><span style=color:#f29668>.</span><span>children}
</span><span>      </span><span style=color:#39bae690>&LT/</span><span style=color:#59c2ff>a</span><span style=color:#39bae690>>
</span><span>    )</span><span style=color:#bfbab0cc>;
</span><span>  }
</span><span>
</span><span>  </span><span style=color:#ff7733>private </span><span style=color:#ffb454>onClick</span><span>(</span><span style=color:#f29718>event</span><span style=color:#f29668>: </span><span style=color:#59c2ff>React</span><span style=color:#f29668>.</span><span style=color:#59c2ff>MouseEvent</span><span><{}>) {
</span><span>    </span><span style=color:#ff7733>const </span><span>{name</span><span style=color:#bfbab0cc>, </span><span>params</span><span style=color:#bfbab0cc>, </span><span>options} </span><span style=color:#f29668>= </span><span style=font-style:italic;color:#39bae6>this</span><span style=color:#f29668>.</span><span>props</span><span style=color:#bfbab0cc>;
</span><span>    </span><span style=color:#ff7733>const </span><span>comboKey </span><span style=color:#f29668>= </span><span>event</span><span style=color:#f29668>.</span><span>metaKey </span><span style=color:#f29668>|| </span><span>event</span><span style=color:#f29668>.</span><span>altKey </span><span style=color:#f29668>|| </span><span>event</span><span style=color:#f29668>.</span><span>ctrlKey </span><span style=color:#f29668>|| </span><span>event</span><span style=color:#f29668>.</span><span>shiftKey</span><span style=color:#bfbab0cc>;
</span><span>
</span><span>    </span><span style=color:#ff7733>if </span><span>(event</span><span style=color:#f29668>.</span><span>button </span><span style=color:#f29668>=== </span><span style=color:#f29718>0 </span><span style=color:#f29668>&& !</span><span>comboKey) {
</span><span>      event</span><span style=color:#f29668>.</span><span style=color:#f07178>preventDefault</span><span>()</span><span style=color:#bfbab0cc>;
</span><span>      router</span><span style=color:#f29668>.</span><span style=color:#f07178>navigate</span><span>(name</span><span style=color:#bfbab0cc>, </span><span>params</span><span style=color:#bfbab0cc>, </span><span>options)</span><span style=color:#bfbab0cc>;
</span><span>    }
</span><span>  }
</span><span>}
</span><span>
</span><span style=color:#ff7733>export default </span><span>Link</span><span style=color:#bfbab0cc>;
</span></code></pre><p>Which can be used like so:<pre class=language-tsx data-lang=tsx style=background:#0f1419;color:#bfbab0><code class=language-tsx data-lang=tsx><span style=color:#39bae690><</span><span style=font-style:italic;color:#39bae6>Link </span><span style=color:#ffb454>name</span><span style=color:#f29668>=</span><span style=color:#c2d94c>"forgot-password"</span><span style=color:#39bae690>></span><span>Forgotten password?</span><span style=color:#39bae690>&LT/</span><span style=font-style:italic;color:#39bae6>Link</span><span style=color:#39bae690>>
</span></code></pre><p>The route name will be checked at compile time as well, no more typos!<h2 id=the-end>The end</h2><p>Will this work for complex apps? I don't know but I will certainly try it and report!<p>Edit: It looks like TypeScript 2.4 will support <a href=https://github.com/Microsoft/TypeScript/pull/15486>string enums</a>! This means we will be able to not duplicate the <code>Routes</code> content and use an enum instead!<p>Edit2: This approach is now in production! Read up on <a href=https://ashang.github.io/zz/posts/testing-a-different-spa-routing/2017-05-24_testing-a-different-spa-routing-update.md>the follow-up article</a>.</section></article></main></div>