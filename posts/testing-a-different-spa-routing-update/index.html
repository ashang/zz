<!doctype html><html class="dark light"><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><title>
         A different approach to routing in Single-Page Applications: now in production
        
    </title><meta content="A different approach to routing in Single-Page Applications: now in production" property=og:title><meta content="A framework agnostic approach to routing for SPA: now in production" property=og:description><meta content="A framework agnostic approach to routing for SPA: now in production" name=description><link href=/icon/favicon.png rel=icon type=image/png><link href=https://ashang.github.io/zz/fonts.css rel=stylesheet><script>MathJax={tex:{inlineMath:[['$','$'],['\\(','\\)']]}}</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link href=https://ashang.github.io/zz/atom.xml rel=alternate title=atbb type=application/atom+xml><link href=https://ashang.github.io/zz/theme/light.css rel=stylesheet><link href=https://ashang.github.io/zz/theme/dark.css id=darkModeStyle rel=stylesheet><link href=https://ashang.github.io/zz/main.css media=screen rel=stylesheet><body><div class=content><header><div class=main><a href=https://ashang.github.io/zz/>atbb</a><div class=socials><a class=social href=https://github.com/ashang/ rel=me> <img alt=github src=/social_icons/github.svg> </a></div></div><nav><a href=$BASE_URL/search/ style=margin-left:.7em>Search</a><a href=/notes style=margin-left:.7em>/notes</a><a href=/posts style=margin-left:.7em>/posts</a><a href=/gallery style=margin-left:.7em>/gallery</a><a href=/tags style=margin-left:.7em>/tags</a><a href=/projects style=margin-left:.7em>/projects</a> | <a href=javascript:void(0) id=dark-mode-toggle onclick=toggleTheme()> <img id=sun-icon src=/feather/sun.svg style=filter:invert(1)> <img id=moon-icon src=/feather/moon.svg> </a><script src=https://ashang.github.io/zz/js/themetoggle.js></script></nav></header><main><article><div class=title><div class=page-header>A different approach to routing in Single-Page Applications: now in production<span class=primary-color style=font-size:1.6em>.</span></div><div class=meta>Posted on <time>2017-05-24</time></div></div><section class=body><p>I've recently wrote <a href=https://ashang.github.io/zz/posts/testing-a-different-spa-routing-update/2017-05-08_testing-a-different-spa-routing.md>an article</a> about a framework agnostic routing approach for SPA and promised to post an update once it is a bit more tested. I have since moved Proppy from <a href=https://github.com/ReactTraining/react-router>react-router</a> v2 to the structure described in my article and the result is pretty great!<p>I did change a few things from it though.<p>First, the <code>onClick</code> of the <code>Link</code> component was incorrect and has been changed to:<pre class=language-ts data-lang=ts style=background:#0f1419;color:#bfbab0><code class=language-ts data-lang=ts><span>private </span><span style=color:#ffb454>onClick</span><span>(event: React</span><span style=color:#f29668>.</span><span>MouseEvent</span><span style=color:#f29668><</span><span>{}</span><span style=color:#f29668>></span><span>) {
</span><span>    event</span><span style=color:#f29668>.</span><span style=color:#f07178>preventDefault</span><span>()</span><span style=color:#bfbab0cc>;
</span><span>    event</span><span style=color:#f29668>.</span><span style=color:#f07178>stopPropagation</span><span>()</span><span style=color:#bfbab0cc>;
</span><span>    </span><span style=font-style:italic;color:#5c6773>// I also changed the props `name` to `to`
</span><span>    </span><span style=color:#ff7733>const </span><span>{to</span><span style=color:#bfbab0cc>, </span><span>params</span><span style=color:#bfbab0cc>, </span><span>options} </span><span style=color:#f29668>= </span><span style=font-style:italic;color:#39bae6>this</span><span style=color:#f29668>.</span><span>props</span><span style=color:#bfbab0cc>;
</span><span>    router</span><span style=color:#f29668>.</span><span style=color:#f07178>navigate</span><span>(to</span><span style=color:#bfbab0cc>, </span><span>params</span><span style=color:#bfbab0cc>, </span><span>options)</span><span style=color:#bfbab0cc>;
</span><span>}
</span></code></pre><p>The store also changed in order to only display an animation after a certain amount of time, avoiding blinking effects:<pre class=language-ts data-lang=ts style=background:#0f1419;color:#bfbab0><code class=language-ts data-lang=ts><span style=color:#ff7733>class </span><span style=color:#59c2ff>RouterStore </span><span>{
</span><span>  @observable current</span><span style=color:#f29668>: </span><span style=color:#59c2ff>State</span><span style=color:#bfbab0cc>;
</span><span>  @observable asyncInProgress </span><span style=color:#f29668>= </span><span style=color:#f29718>false</span><span style=color:#bfbab0cc>;
</span><span>  </span><span style=font-style:italic;color:#5c6773>// Only happens if the page wasn't loaded in less than 500ms
</span><span>  @observable showLoadingScreen </span><span style=color:#f29668>= </span><span style=color:#f29718>false</span><span style=color:#bfbab0cc>;
</span><span>  loadingTimeout</span><span style=color:#f29668>: </span><span style=font-style:italic;color:#39bae6>null </span><span style=color:#f29668>| </span><span style=font-style:italic;color:#39bae6>number</span><span style=color:#bfbab0cc>;
</span><span>
</span><span>  @action </span><span style=color:#ffb454>setCurrent</span><span>(</span><span style=color:#f29718>state</span><span style=color:#f29668>: </span><span style=color:#59c2ff>State</span><span>) {
</span><span>    </span><span style=font-style:italic;color:#39bae6>this</span><span style=color:#f29668>.</span><span>current </span><span style=color:#f29668>= </span><span>state</span><span style=color:#bfbab0cc>;
</span><span>    </span><span style=font-style:italic;color:#39bae6>this</span><span style=color:#f29668>.</span><span>asyncInProgress </span><span style=color:#f29668>= </span><span style=color:#f29718>false</span><span style=color:#bfbab0cc>;
</span><span>    </span><span style=color:#f07178>clearTimeout</span><span>(</span><span style=font-style:italic;color:#39bae6>this</span><span style=color:#f29668>.</span><span>loadingTimeout)</span><span style=color:#bfbab0cc>;
</span><span>    </span><span style=font-style:italic;color:#39bae6>this</span><span style=color:#f29668>.</span><span>showLoadingScreen </span><span style=color:#f29668>= </span><span style=color:#f29718>false</span><span style=color:#bfbab0cc>;
</span><span>  }
</span><span>
</span><span>  @action </span><span style=color:#ffb454>startAsyncLoading</span><span>() {
</span><span>    </span><span style=font-style:italic;color:#39bae6>this</span><span style=color:#f29668>.</span><span>asyncInProgress </span><span style=color:#f29668>= </span><span style=color:#f29718>true</span><span style=color:#bfbab0cc>;
</span><span>    </span><span style=font-style:italic;color:#39bae6>this</span><span style=color:#f29668>.</span><span>loadingTimeout </span><span style=color:#f29668>= </span><span style=color:#f07178>setTimeout</span><span>(() </span><span style=color:#ff7733>=> </span><span style=font-style:italic;color:#39bae6>this</span><span style=color:#f29668>.</span><span>showLoadingScreen </span><span style=color:#f29668>= </span><span style=color:#f29718>true</span><span style=color:#bfbab0cc>, </span><span style=color:#f29718>500</span><span>)</span><span style=color:#bfbab0cc>;
</span><span>  }
</span><span>}
</span></code></pre><p>Any component can now observe <code>showLoadingScreen</code> and render a loading effect very easily. 500 milliseconds is probably too high but I was on a slow connection several thousands of kilometers away from our servers when I tried it.<p>The only issue we encountered was that some users were faced with a blank page. I was not able to reproduce it and no errors were reported to our Sentry server. After a couple of unsuccessful debugging sessions, I noticed something in the <a href=http://router5.github.io/docs/router-options.html>router5 documentation</a>: the <code>strictQueryParams</code>.<p>By default in <code>router5</code>, a route with a path of <code>/</code> will not be matched by the URL <code>/?_ga=blabla</code>: turns out this was exactly what was happening for Proppy. I <a href=https://github.com/router5/router5/issues/137>opened an issue</a> to change the default to a saner one and it seems it will happen, but in the next major version as this is a breaking change. In the meantime, the paragraph about <code>strictQueryParams</code> got moved to the top in the docs in order to be more visible.<p>Lastly, someone mailed me mentioning <a href=https://github.com/LeonardoGentile/react-mobx-router5>react-mobx-router5</a> which was inspired by <a href=https://hackernoon.com/how-to-decouple-state-and-ui-a-k-a-you-dont-need-componentwillmount-cc90b787aa37>the same article</a> as this serie of posts. I think a library for this routing approach is overkill. Pretty much all the code needed is in the <a href=https://ashang.github.io/zz/posts/testing-a-different-spa-routing-update/2017-05-08_testing-a-different-spa-routing.md>previous article</a> and is less than 100 LOC that you can customise any way you want since different apps will have different needs.</section></article></main></div>