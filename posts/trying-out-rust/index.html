<!doctype html><html class="dark light"><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><title>
         Trying out Rust
        
    </title><meta content="Trying out Rust" property=og:title><meta content="Checking out that new language from Mozilla" property=og:description><meta content="Checking out that new language from Mozilla" name=description><link href=/icon/favicon.png rel=icon type=image/png><link href=https://ashang.github.io/zz/fonts.css rel=stylesheet><script>MathJax={tex:{inlineMath:[['$','$'],['\\(','\\)']]}}</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link href=https://ashang.github.io/zz/atom.xml rel=alternate title=atbb type=application/atom+xml><link href=https://ashang.github.io/zz/theme/light.css rel=stylesheet><link href=https://ashang.github.io/zz/theme/dark.css id=darkModeStyle rel=stylesheet><link href=https://ashang.github.io/zz/main.css media=screen rel=stylesheet><body><div class=content><header><div class=main><a href=https://ashang.github.io/zz/>atbb</a><div class=socials><a class=social href=https://github.com/ashang/ rel=me> <img alt=github src=/social_icons/github.svg> </a></div></div><nav><a href=$BASE_URL/search/ style=margin-left:.7em>Search</a><a href=/notes style=margin-left:.7em>/notes</a><a href=/posts style=margin-left:.7em>/posts</a><a href=/gallery style=margin-left:.7em>/gallery</a><a href=/tags style=margin-left:.7em>/tags</a><a href=/projects style=margin-left:.7em>/projects</a> | <a href=javascript:void(0) id=dark-mode-toggle onclick=toggleTheme()> <img id=sun-icon src=/feather/sun.svg style=filter:invert(1)> <img id=moon-icon src=/feather/moon.svg> </a><script src=https://ashang.github.io/zz/js/themetoggle.js></script></nav></header><main><article><div class=title><div class=page-header>Trying out Rust<span class=primary-color style=font-size:1.6em>.</span></div><div class=meta>Posted on <time>2014-07-19</time></div></div><h1>Table of Contents</h1><ul><li><a href=https://ashang.github.io/zz/posts/trying-out-rust/#what-s-rust>What's Rust?</a> <ul><li><a href=https://ashang.github.io/zz/posts/trying-out-rust/#type-system>Type system</a></ul><li><a href=https://ashang.github.io/zz/posts/trying-out-rust/#memory-safety>Memory safety</a> <ul><li><a href=https://ashang.github.io/zz/posts/trying-out-rust/#easy-concurrency-with-no-data-race>Easy concurrency with no data race</a><li><a href=https://ashang.github.io/zz/posts/trying-out-rust/#functional-stuff>Functional stuff</a></li><ul><li><a href=https://ashang.github.io/zz/posts/trying-out-rust/#options>Options</a><li><a href=https://ashang.github.io/zz/posts/trying-out-rust/#pattern-matching>Pattern matching</a><li><a href=https://ashang.github.io/zz/posts/trying-out-rust/#general-functional-functions>General 'functional' functions</a></ul></ul><li><a href=https://ashang.github.io/zz/posts/trying-out-rust/#what-do-i-think-of-it>What do I think of it?</a></ul><section class=body><p>Rust is an in-progress systems programming language (<a href=http://www.rust-lang.org/>official website</a>). I'll start this post by saying I'm a python/js/go developer and never really done C or C++ (my first programming languages were PHP/C# actually since I started with a degree in biology). Rust is mainly targeting those C/C++ developers that need speed (without a GC) and safety. As a guy who does only web stuff, the absence/presence of a GC is not important since you can use slow languages like python or ruby and be completely fine with it for 99% of the sites so a GC pause probably won't even be noticed unlike in video games for example. Why bother learning low level languages then?<ul><li>It's fun<li>It's fast<li>It has types (I love types)</ul><p>This is just my feelings after playing with it a few hours, it may contain mistakes and some stuff will probably be outdated pretty soon anyway. Like every article I've read, I'll be comparing some of the features with Go but do note that I like them both.<h2 id=what-s-rust>What's Rust?</h2><p>As mentioned above, Rust is a language developed by Mozilla in the open: all the code is on github, decisions are taken by committee. A stable release is expected around Q4 of 2014. You can follow or even submit/comment on RFCs on the language: <a href=https://github.com/rust-lang/rfcs>RFCs repo</a>, decisions on these RFCs being taken in meetings for which you can find the transcripts on <a href=https://github.com/rust-lang/meeting-minutes>github as well</a>. The language itself is also in github in case you didn't guess: <a href=https://github.com/rust-lang/rust>rust repo</a>. More discussions also happen on reddit (<a href=http://www.reddit.com/r/rust>/r/rust</a>) and on the <a href=https://users.rust-lang.org/>discourse forum</a>. I talked quite a bit about the community because I find looking at the evolution quite fascinating, let's talk a bit about the language itself now.<p>Let's use bullet points and then go through those individually<ul><li>Statically and strongly typed with generics (yay!)<li>Memory safety<li>Easy concurrency with no data race<li>Functional stuff</ul><h3 id=type-system>Type system</h3><p>It is pretty cool. Variables are immutable by default and the compiler will complain if you are using a variable before initalizing it (not very idiomatic in Rust to initialize a variable after declaring it apparently anyway) or if it's unused (you can make that fail compilation if you want). It has generics which allows some cool stuff without passing interface{} if you wanted to do something similar in Go (let's say an ORM). It uses traits rather than the classic interfaces OOP languages, if you've used Scala it will be familiar.<h2 id=memory-safety>Memory safety</h2><p>Part of that section could go in the type system section but since this is the complex part of rust for newcomer like me I feel it deserves its own section. There are 3 types of pointers in Rust:<ul><li>owned pointers: the classic ones, compiler takes care of them automatically<li>borrowed pointers: as the name implies, you can use them when you want to access data, but without taking ownership of it</ul><p>Ownership (and mainly the lifetimes that go with it) is a major point of Rust and documentation will do a better job than me at explaining them: <a href=https://doc.rust-lang.org/1.36.0/book/ch10-03-lifetime-syntax.html>The Rust References and Lifetimes Guide</a>.<h3 id=easy-concurrency-with-no-data-race>Easy concurrency with no data race</h3><p>Concurrency in Rust is as easy as in Go, here's a very basic example:<pre class=language-rust data-lang=rust style=background:#0f1419;color:#bfbab0><code class=language-rust data-lang=rust><span style=font-style:italic;color:#5c6773>// run on http://is.gd/kDPsLe
</span><span style=color:#ff7733>fn </span><span style=color:#ffb454>main</span><span>() {
</span><span>    </span><span style=color:#ff7733>let </span><span>(tx</span><span style=color:#bfbab0cc>,</span><span> rx)</span><span style=color:#bfbab0cc>: </span><span>(Sender&LTint></span><span style=color:#bfbab0cc>, </span><span>Receiver&LTint>) </span><span style=color:#f29668>= </span><span style=color:#f07178>channel</span><span>()</span><span style=color:#bfbab0cc>;
</span><span>
</span><span>    </span><span style=color:#f07178>spawn</span><span>(</span><span style=color:#ff3333>proc</span><span>() { tx</span><span style=color:#f29668>.</span><span style=color:#f07178>send</span><span>(</span><span style=color:#f29718>1</span><span>)</span><span style=color:#bfbab0cc>; </span><span>})</span><span style=color:#bfbab0cc>;
</span><span>
</span><span>    </span><span style=color:#ff7733>let</span><span> result </span><span style=color:#f29668>=</span><span> rx</span><span style=color:#f29668>.</span><span style=color:#f07178>recv</span><span>()</span><span style=color:#bfbab0cc>;
</span><span>}
</span></code></pre><p>It is very easy to read and I actually find it easier to have the named channels like this than reading from the channel. The "no data race" part comes from the fact that you cannot access mutable data inside a task (It won't even let you reuse the tx variable here in another as you can see in that <a href=http://is.gd/ncfyM4>playpen</a>. Trying to modify a mutable structure for example would result in a compiler error: <a href=http://is.gd/5AFfTn>playpen</a>. An in-depth explanation is also present in the docs: <a href=http://doc.rust-lang.org/guide-tasks.html>The Rust Tasks and Communication Guide</a>.<h3 id=functional-stuff>Functional stuff</h3><p>I'm usually a bit wary of functional elements as it can sometimes be very hard to read and understand at a glance what a functional programmer did when he was being 'neat'. Nevertheless, functional programming also brings very very cool stuff:<h4 id=options>Options</h4><p>An idiomatic Go function will usually return 2 elements: a value and an error. You will have to check whether the error is nil or not and handle both cases<pre class=language-go data-lang=go style=background:#0f1419;color:#bfbab0><code class=language-go data-lang=go><span>books</span><span style=color:#bfbab0cc>, </span><span>err </span><span style=color:#f29668>:= </span><span style=color:#ffb454>GetBooks</span><span>()
</span><span style=color:#ff7733>if </span><span>err </span><span style=color:#f29668>!= </span><span style=color:#f29718>nil </span><span>{
</span><span>  </span><span style=color:#ff7733>return </span><span style=color:#f29718>nil</span><span style=color:#bfbab0cc>, </span><span>err
</span><span>}
</span><span>books </span><span style=color:#f29668>= </span><span>books[</span><span style=color:#bfbab0cc>:</span><span style=color:#f29718>5</span><span>] </span><span style=font-style:italic;color:#5c6773>// will give a nil error if we didn't check the error above
</span><span style=color:#ff7733>return </span><span>books</span><span style=color:#bfbab0cc>, </span><span style=color:#f29718>nil
</span></code></pre><p>I don't mind explicit error handling but it's easy to forget it somewhere and end up with a null pointer exception. Options are basically nullable types that forces you to handle them, enforced by the compiler. It is typically handled using pattern matching.<h4 id=pattern-matching>Pattern matching</h4><p>Those are amazing, like a switch but way more powerful. To handle something that could fail like the Go example above, it would look like this.<pre class=language-rust data-lang=rust style=background:#0f1419;color:#bfbab0><code class=language-rust data-lang=rust><span style=font-style:italic;color:#5c6773>// Example from docs with a few more stuff added
</span><span style=color:#ff7733>fn </span><span style=color:#ffb454>divide</span><span>(</span><span style=color:#f29718>numerator</span><span style=color:#bfbab0cc>: </span><span style=color:#ff7733>f64</span><span>, </span><span style=color:#f29718>denominator</span><span style=color:#bfbab0cc>: </span><span style=color:#ff7733>f64</span><span>) </span><span style=color:#bfbab0cc>-> </span><span style=font-style:italic;color:#39bae6>Option</span><span><</span><span style=color:#ff7733>f64</span><span>> {
</span><span>    </span><span style=color:#ff7733>if</span><span> denominator </span><span style=color:#f29668>== </span><span style=color:#f29718>0.0 </span><span>{
</span><span>        </span><span style=font-style:italic;color:#39bae6>None
</span><span>    } </span><span style=color:#ff7733>else </span><span>{
</span><span>        </span><span style=font-style:italic;color:#39bae6>Some</span><span>(numerator </span><span style=color:#f29668>/</span><span> denominator)
</span><span>    }
</span><span>}
</span><span>
</span><span style=font-style:italic;color:#5c6773>// The return value of the function is an option
</span><span style=color:#ff7733>let</span><span> result </span><span style=color:#f29668>= </span><span style=color:#f07178>divide</span><span>(</span><span style=color:#f29718>2.0</span><span style=color:#bfbab0cc>, </span><span style=color:#f29718>3.0</span><span>)</span><span style=color:#bfbab0cc>;
</span><span>
</span><span style=font-style:italic;color:#5c6773>// Pattern match to retrieve the value
</span><span style=color:#ff7733>match</span><span> result {
</span><span>    </span><span style=font-style:italic;color:#39bae6>Some</span><span>(</span><span style=color:#f29718>1.0</span><span>) </span><span style=color:#f29668>=> </span><span style=color:#f07178>println!</span><span>(</span><span style=color:#c2d94c>"Result was exactly 1"</span><span>)</span><span style=color:#bfbab0cc>,
</span><span>    </span><span style=font-style:italic;color:#39bae6>Some</span><span>(x) </span><span style=color:#f29668>=> </span><span style=color:#f07178>println!</span><span>(</span><span style=color:#c2d94c>"Result: </span><span style=color:#f29718>{}</span><span style=color:#c2d94c>"</span><span style=color:#bfbab0cc>,</span><span> x)</span><span style=color:#bfbab0cc>,
</span><span>    </span><span style=font-style:italic;color:#39bae6>None    </span><span style=color:#f29668>=> </span><span style=color:#f07178>println!</span><span>(</span><span style=color:#c2d94c>"Cannot divide by 0"</span><span>)</span><span style=color:#bfbab0cc>,
</span><span>    </span><span style=color:#f29668>_ => </span><span style=color:#f07178>println!</span><span>(</span><span style=color:#c2d94c>"Nothing"</span><span>) </span><span style=font-style:italic;color:#5c6773>// Compiler will fail and tell that this is unreachable as you're dealing with Some and None
</span><span>}
</span></code></pre><p>A playpen is available <a href=http://is.gd/0tW2Bc>here</a>, modify the paraneters to divide and the pattern matching to see how it works. You could match on types, on values, this makes the code really neat imo and is awesome.<pre class=language-rust data-lang=rust style=background:#0f1419;color:#bfbab0><code class=language-rust data-lang=rust><span style=color:#ff7733>fn </span><span style=color:#ffb454>main</span><span>() {
</span><span>    </span><span style=color:#ff7733>let</span><span> x </span><span style=color:#f29668>=</span><span> 10i</span><span style=color:#bfbab0cc>;
</span><span>
</span><span>    </span><span style=color:#ff7733>match</span><span> x {
</span><span>        </span><span style=color:#f29718>0 </span><span style=color:#f29668>=> </span><span style=color:#f07178>println!</span><span>(</span><span style=color:#c2d94c>"It's 0!"</span><span>)</span><span style=color:#bfbab0cc>,
</span><span>        </span><span style=color:#f29718>1 </span><span style=color:#f29668>..</span><span style=color:#f29718>9 </span><span style=color:#f29668>=> </span><span style=color:#f07178>println!</span><span>(</span><span style=color:#c2d94c>"Between 1 and 9: </span><span style=color:#f29718>{}</span><span style=color:#c2d94c>"</span><span style=color:#bfbab0cc>,</span><span> x)</span><span style=color:#bfbab0cc>,
</span><span>        </span><span style=color:#f29668>_ => </span><span style=color:#f07178>println!</span><span>(</span><span style=color:#c2d94c>"Different from 0-9: </span><span style=color:#f29718>{}</span><span style=color:#c2d94c>"</span><span style=color:#bfbab0cc>,</span><span> x) </span><span style=font-style:italic;color:#5c6773>// needed to be exhaustive here, compiler will yell without it
</span><span>    }</span><span style=color:#bfbab0cc>;
</span><span>}
</span></code></pre><h4 id=general-functional-functions>General 'functional' functions</h4><p>I did the first Euler problems in Rust to get the hang of it and everytime I started with the naive approach of looping. After reading a bit of code from experience devs, I realised you could do some nice stuff like defining a Fibonacci iterator and making a simple one liner after that to solve <a href="https://projecteuler.net/problem=2">problem 2</a>:<pre class=language-rust data-lang=rust style=background:#0f1419;color:#bfbab0><code class=language-rust data-lang=rust><span>Fibonacci</span><span style=color:#f29668>::</span><span>new()</span><span style=color:#f29668>.</span><span style=color:#f07178>take_while</span><span>(|</span><span style=color:#f29668>&</span><span style=color:#f29718>i</span><span>| i </span><span style=color:#f29668><= </span><span style=color:#f29718>4000000</span><span>)</span><span style=color:#f29668>.</span><span style=color:#f07178>filter</span><span>(|</span><span style=color:#f29668>&</span><span style=color:#f29718>i</span><span>| i </span><span style=color:#f29668>% </span><span style=color:#f29718>2 </span><span style=color:#f29668>== </span><span style=color:#f29718>0</span><span>)</span><span style=color:#f29668>.</span><span style=color:#f07178>sum</span><span>()</span><span style=color:#bfbab0cc>;
</span></code></pre><h2 id=what-do-i-think-of-it>What do I think of it?</h2><p>As you saw from the previous part, I'm quite enthusiastic about it. It's still too much in flux to be used seriously but I think that it could become a pretty big thing. Again, talking from the point of view of websites/services, it could become a nice alternative to Go (as more and more companies start using it for services). The fact that they're also building a package manager (<a href=https://github.com/rust-lang/cargo>Cargo</a>) along the language is a very nice thing, solving the whole dependencies issues in Go, I need to find out whether they plan to include vendoring or not. I think Go is easier to pick up (language has less features, some people will consider that a minus, other a plus), has the community behind it and tools like gofmt (<a href=https://github.com/pcwalton/rustfmt>one</a> is in the works for Rust). Another issue Rust currently has is that it is changing very fast, most of the threads/posts talking about it will not work in the current version and that is confusing. Up to date resources includes:<ul><li>http://rustbyexample.com/<li>http://doc.rust-lang.org/std/index.html (very helpful since there's no autocompletion yet, there's <a href=https://github.com/phildawes/racer>racer</a> but it doesn't seem finished)</ul><p>Overall, I'll keep an eye on it and try to do a small project on it as soon as I have some free time.</section></article></main></div>